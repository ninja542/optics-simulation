var app=new Vue({el:"#wrapper",data:{name:""},watch:{name:function(){"Plane Mirror"===this.name?planeMirrorRay():"Convex Lens"===this.name?convexLensRay():"Convex Mirror"===this.name?convexMirrorRay():"Concave Lens"===this.name?concaveLensRay():"Concave Mirror"===this.name&&concaveMirrorRay()}},mounted:function(){this.name="Convex Lens"}}),margin={top:40,right:40,bottom:40,left:40},width=1e3-margin.left-margin.right,height=600-margin.top-margin.bottom,svg=d3.select("#simulation").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).select("#transform").attr("transform","translate("+margin.left+","+margin.top+")"),xScale=d3.scaleLinear().domain([-100,100]).range([0,width]),xAxis=d3.axisBottom(xScale),yScale=d3.scaleLinear().domain([100,-100]).range([0,height]),yAxis=d3.axisLeft(yScale);svg.append("g").call(xAxis).attr("transform","translate(0, "+yScale(0)+")"),svg.append("g").call(yAxis).attr("transform","translate("+xScale(0)+", "+0+")");var line=d3.line().x(function(a){return a.x}).y(function(a){return a.y});svg.append("path").attr("stroke-width",1).attr("stroke","black").attr("fill","none").attr("stroke-dasharray","5, 10").attr("class","dashedRayTop"),svg.append("path").attr("stroke-width",1).attr("stroke","red").attr("fill","none").attr("stroke-dasharray","5, 10").attr("class","dashedRayBottom"),svg.append("path").attr("stroke-width",1).attr("stroke","black").attr("fill","none").attr("class","solidRayTop"),svg.append("path").attr("stroke-width",1).attr("stroke","black").attr("fill","none").attr("class","rayFocus"),svg.append("path").attr("stroke-width",1).attr("stroke","red").attr("fill","none").attr("class","solidRayBottom"),svg.append("path").attr("stroke-width",1).attr("stroke","red").attr("fill","none").attr("class","rayFocusBottom"),svg.append("path").attr("stroke-width",1).attr("stroke","black").attr("fill","none").attr("class","dashedLineTop").attr("stroke-dasharray","5 10").attr("visibility","hidden"),svg.append("path").attr("stroke-width",1).attr("stroke","red").attr("fill","none").attr("class","dashedLineBottom").attr("stroke-dasharray","5 10").attr("visibility","hidden"),svg.append("path").attr("stroke-width",1).attr("stroke","black").attr("fill","none").attr("class","dashedExtraTop").attr("stroke-dasharray","5 10").attr("visibility","hidden"),svg.append("path").attr("stroke-width",1).attr("stroke","red").attr("fill","none").attr("class","dashedExtraBottom").attr("stroke-dasharray","5 10").attr("visibility","hidden");var circleEye=[{x:0,y:0}],eye=svg.selectAll("circle").data(circleEye).enter().append("circle").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("r",10).style("fill","#000").attr("id","eye"),eyeBound=d3.select("#eye").node().getBoundingClientRect(),mirrorBound=d3.select("#mirror").node().getBoundingClientRect(),pencilBound=d3.select("#object").node().getBoundingClientRect();d3.select("#mirror").attr("transform","translate("+xScale(0)+", "+(yScale(0)-mirrorBound.height/2)+")"),d3.select("#object").attr("transform","translate("+(xScale(-60)-pencilBound.width/2)+","+(yScale(0)-pencilBound.height/2)+")"),d3.select("#eye").attr("transform","translate("+xScale(-40)+", "+yScale(40)+")");var focus=20,focusData=[{x:null,y:null},{x:focus,y:0},{x:-focus,y:0}];svg.selectAll("circle").data(focusData).enter().append("circle").attr("cx",function(a){return xScale(a.x)}).attr("cy",function(a){return yScale(a.y)}).attr("r",3).attr("fill","#000").attr("class","focusData");function planeMirrorRay(){function a(){d3.select(".solidRayTop").attr("d",line(g())),d3.select(".dashedRayTop").attr("d",line(i())),d3.select(".solidRayBottom").attr("d",line(k())),d3.select(".dashedRayBottom").attr("d",line(j()))}function b(){d3.select(this).raise()}let g=function(){return boundUpdate(),[{x:eyeBound.x-margin.right+window.scrollX,y:eyeBound.y-margin.top+window.scrollY},{x:xScale(0),y:l(pencilBound.y)},{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY}]},i=function(){return boundUpdate(),[g()[1],{x:imageBound.x-margin.left+window.scrollX,y:imageBound.y-margin.top+window.scrollY}]},j=function(){return boundUpdate(),[k()[1],{x:imageBound.x-margin.right-imageBound.width+window.scrollX,y:imageBound.y+imageBound.height-margin.top-9+window.scrollY}]},k=function(){return boundUpdate(),[{x:eyeBound.x-margin.right+window.scrollX,y:eyeBound.y-margin.top+window.scrollY},{x:xScale(0),y:l(pencilBound.y+pencilBound.height-9)},{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY}]},l=function(n){boundUpdate();var o=xScale(0)-eyeBound.x+margin.right-window.scrollX,p=xScale(0)-pencilBound.x+margin.right-window.scrollX,q=eyeBound.y-margin.top+window.scrollY,r=n-margin.top+window.scrollY;return(r*o+q*p)/(o+p)};a(),boundUpdate(),svg.select("#object-image").attr("transform","translate("+(2*xScale(0)-(pencilBound.x-margin.right+window.scrollX))+","+(pencilBound.y-margin.top+window.scrollY)+")");let m=d3.drag().on("start",b).on("drag",function(){let n=this.getBoundingClientRect();var o=d3.event.x-n.width/2,p=d3.event.y-n.height/2;d3.select(this).attr("transform","translate("+Math.min(o,xScale(0)-n.width)+","+p+")"),svg.select("#object-image").attr("transform","translate("+Math.max(xScale(0),xScale(100)-d3.event.x-n.width/2)+","+p+")"),a()});d3.select("#object").call(m),eye.call(d3.drag().on("start",b).on("drag",function(n){d3.select(this).attr("cx",n.x=Math.min(xScale(-60)-10,d3.event.x)).attr("cy",n.y=d3.event.y),a()}))}function convexLensRay(){function a(){boundUpdate();pencilBound.x-margin.right+window.scrollX>=xScale(-focus)-1&&pencilBound.x-margin.right+window.scrollX<=xScale(-focus)+1||(d3.selectAll(".solidRayTop").attr("d",line(i())),d3.select(".rayFocus").attr("d",line(k())),d3.select(".solidRayBottom").attr("d",line(j())),d3.select(".rayFocusBottom").attr("d",line(l())),d3.select(".dashedLineTop").attr("d",line(m())),d3.select(".dashedLineBottom").attr("d",line(n())),d3.select(".dashedExtraTop").attr("d",line(o())),d3.select(".dashedExtraBottom").attr("d",line(p())),d3.select(".dashedLineTop").attr("visibility","hidden"),d3.select(".dashedLineBottom").attr("visibility","hidden"),d3.select(".dashedExtraTop").attr("visibility","hidden"),d3.select(".dashedExtraBottom").attr("visibility","hidden"),q(),pencilBound.x-margin.right+window.scrollX>xScale(-focus)?(d3.select(".rayFocus").attr("stroke-dasharray","5 10"),d3.select(".rayFocusBottom").attr("stroke-dasharray","5 10"),d3.select(".dashedLineTop").attr("visibility","visible"),d3.select(".dashedLineBottom").attr("visibility","visible"),d3.select(".dashedExtraTop").attr("visibility","visible"),d3.select(".dashedExtraBottom").attr("visibility","visible")):(d3.select(".rayFocus").attr("stroke-dasharray","none"),d3.select(".rayFocusBottom").attr("stroke-dasharray","none")))}d3.select("#eye").attr("visibility","hidden");var e=d3.select("#convex-lens2").node().getBoundingClientRect();svg.select("#convex-lens2").attr("transform","translate("+(xScale(0)-e.width/2)+", "+0+")");let g=function(s,t=focus,u=yScale(0)){boundUpdate();let v=(yScale(0)-(pencilBound.y-margin.top+window.scrollY))/(xScale(-focus)-(pencilBound.x-margin.right+window.scrollX));if(s.includes("x"))return s.includes("bottom")?(v=(pencilBound.y+pencilBound.height-margin.top-9+window.scrollY-yScale(0))/(xScale(-focus)-(pencilBound.x-margin.right+window.scrollX)),yScale(0)-v*(xScale(0)-xScale(-focus))):yScale(0)+v*(xScale(0)-xScale(-focus));return s.includes("y")?s.includes("bottom")?(v=(pencilBound.y+pencilBound.height-9-margin.top+window.scrollY-yScale(0))/(xScale(focus)-xScale(0)),v*(xScale(100)-xScale(t))-u):(v=(yScale(0)-(pencilBound.y-margin.top+window.scrollY))/(xScale(focus)-xScale(0)),u+v*(xScale(100)-xScale(t))):void 0},i=function(){return boundUpdate(),pencilBound.x-margin.right+window.scrollX<xScale(-focus)?[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(focus),y:yScale(0)},{x:xScale(100),y:g("y")}]:[{x:xScale(100),y:g("x")},{x:xScale(0),y:g("x")},{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(focus),y:yScale(0)},{x:xScale(100),y:g("y")}]},j=function(){return boundUpdate(),pencilBound.x-margin.right+window.scrollX<xScale(-focus)?[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(0),y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(focus),y:yScale(0)},{x:xScale(100),y:-g("y bottom")}]:[{x:xScale(100),y:g("x bottom")},{x:xScale(0),y:g("x bottom")},{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(0),y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(focus),y:yScale(0)},{x:xScale(100),y:-g("y bottom")}]},k=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(-focus),y:yScale(0)},{x:xScale(0),y:g("x")},{x:xScale(100),y:g("x")}]},l=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(-focus),y:yScale(0)},{x:xScale(0),y:g("x bottom")},{x:xScale(100),y:g("x bottom")}]},m=function(){return boundUpdate(),[{x:xScale(0),y:g("x")},{x:xScale(-100),y:g("x")}]},n=function(){return boundUpdate(),[{x:xScale(0),y:g("x bottom")},{x:xScale(-100),y:g("x bottom")}]},o=function(){return boundUpdate(),[{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(-100),y:2*(pencilBound.y-margin.top+window.scrollY)-g("y",0,pencilBound.y-margin.top+window.scrollY)}]},p=function(){return boundUpdate(),[{x:xScale(0),y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(-100),y:g("y bottom",0,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY-2*(pencilBound.y+pencilBound.height-9-margin.top+window.scrollY))}]};boundUpdate();let q=function(){boundUpdate();let s=xScale(focus)-xScale(0),t=xScale(0)-(pencilBound.x-margin.right+window.scrollX),u=1/(1/s-1/t),v=g("x")-g("x bottom"),w=v/pencilBound.height;pencilBound.x-margin.right+window.scrollX>xScale(-focus)?(d3.select("#object-image").attr("transform","rotate(180) scale("+w+") translate("+-(xScale(0)+u-imageBound.width)/w+", "+-g("x")/w+")"),d3.select(".cls-1").style("fill","rgba(13, 159, 241, 0.5)")):(d3.select("#object-image").attr("transform","rotate(180) scale("+w+") translate("+-(xScale(0)+u+imageBound.width)/w+", "+-g("x")/w+")"),d3.select(".cls-1").style("fill","rgba(255, 255, 0, 0.5)"))};q(),a();var r=d3.drag().on("start",function(){d3.select(this).raise()}).on("drag",function(){let s=this.getBoundingClientRect();var t=d3.event.x-s.width/2,u=d3.event.y-s.height/2;d3.select(this).attr("transform","translate("+Math.min(t,xScale(0)-s.width)+","+u+")"),a()});d3.select("#object").call(r)}function convexMirrorRay(){function a(){boundUpdate(),d3.select(".solidRayTop").attr("d",line(i())),d3.select(".rayFocus").attr("d",line(j())),d3.select(".solidRayBottom").attr("d",line(k())),d3.select(".rayFocusBottom").attr("d",line(l())),d3.select(".dashedLineTop").attr("d",line(o())),d3.select(".dashedLineTop").attr("visibility","visible"),d3.select(".dashedLineBottom").attr("d",line(p())),d3.select(".dashedLineBottom").attr("visibility","visible"),d3.select(".dashedExtraTop").attr("d",line(m())),d3.select(".dashedExtraTop").attr("visibility","visible").attr("stroke-dasharray","none"),d3.select(".dashedExtraBottom").attr("d",line(n())),d3.select(".dashedExtraBottom").attr("visibility","visible").attr("stroke-dasharray","none"),q(),d3.select(".rayFocus").attr("stroke-dasharray","5 10"),d3.select(".rayFocusBottom").attr("stroke-dasharray","5 10")}var e=d3.select("#convex-mirror2").node().getBoundingClientRect();d3.select("#convex-mirror2").attr("transform","translate("+(xScale(0)-e.width/2)+", "+0+")");let g=function(s,t=focus,u=yScale(0)){boundUpdate();let v=(yScale(0)-(pencilBound.y-margin.top+window.scrollY))/(xScale(t)-(pencilBound.x-margin.right+window.scrollX));if(s.includes("x"))return s.includes("bottom")?(v=(pencilBound.y+pencilBound.height-margin.top-9+window.scrollY-yScale(0))/(xScale(t)-(pencilBound.x-margin.right+window.scrollX)),yScale(0)-v*(xScale(0)-xScale(-focus))):yScale(0)+v*(xScale(0)-xScale(-focus));return s.includes("y")?s.includes("bottom")?(v=(pencilBound.y+pencilBound.height-9-margin.top+window.scrollY-yScale(0))/(xScale(focus)-xScale(0)),v*(xScale(100)-xScale(t))-u):(v=(yScale(0)-(pencilBound.y-margin.top+window.scrollY))/(xScale(focus)-xScale(0)),u+v*(xScale(100)-xScale(t))):void 0},i=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(-100),y:2*(pencilBound.y-margin.top+window.scrollY)-g("y",0,pencilBound.y-margin.top+window.scrollY)}]},j=function(){return boundUpdate(),[{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(focus),y:yScale(0)}]},k=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(0),y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(-100),y:2*(pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)+g("y bottom",0,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},l=function(){return boundUpdate(),[{x:xScale(0),y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(focus),y:yScale(0)}]},m=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(0),y:2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)},{x:xScale(-100),y:2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},n=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(0),y:2*yScale(0)-g("x bottom",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)},{x:xScale(-100),y:2*yScale(0)-g("x bottom",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},o=function(){return boundUpdate(),[{x:xScale(0),y:2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)},{x:xScale(100),y:2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},p=function(){return boundUpdate(),[{x:xScale(0),y:2*yScale(0)-g("x bottom",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)},{x:xScale(100),y:2*yScale(0)-g("x bottom",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},q=function(){boundUpdate();let s=xScale(0)-xScale(focus),t=xScale(0)-(pencilBound.x-margin.right+window.scrollX),v=g("x")-g("x bottom"),w=v/pencilBound.height;d3.select("#object-image").attr("transform","scale("+w+") translate("+(xScale(0)-1/(1/s-1/t))/w+", "+(2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY))/w+")"),d3.select(".cls-1").style("fill","rgba(13, 159, 241, 0.5)")};q(),a();var r=d3.drag().on("start",function(){d3.select(this).raise()}).on("drag",function(){let s=this.getBoundingClientRect();var t=d3.event.x-s.width/2,u=d3.event.y-s.height/2;d3.select(this).attr("transform","translate("+Math.min(t,xScale(0)-s.width)+","+u+")"),a()});d3.select("#object").call(r),console.log(document.querySelector(".solidRayTop").getPointAtLength(100))}function concaveLensRay(){function a(){boundUpdate(),d3.select(".solidRayTop").attr("d",line(i())),d3.select(".rayFocus").attr("d",line(j())),d3.select(".solidRayBottom").attr("d",line(k())),d3.select(".rayFocusBottom").attr("d",line(l())),d3.select(".dashedLineTop").attr("d",line(o())),d3.select(".dashedLineTop").attr("visibility","visible"),d3.select(".dashedLineBottom").attr("d",line(p())),d3.select(".dashedLineBottom").attr("visibility","visible"),d3.select(".dashedExtraTop").attr("d",line(m())),d3.select(".dashedExtraTop").attr("visibility","visible").attr("stroke-dasharray","none"),d3.select(".dashedExtraBottom").attr("d",line(n())),d3.select(".dashedExtraBottom").attr("visibility","visible").attr("stroke-dasharray","none"),q(),d3.select(".rayFocus").attr("stroke-dasharray","5 10"),d3.select(".rayFocusBottom").attr("stroke-dasharray","5 10")}var e=d3.select("#concave-lens2").node().getBoundingClientRect();d3.select("#concave-lens2").attr("transform","translate("+(xScale(0)-e.width/2)+", "+0+")");let g=function(s,t=focus,u=yScale(0)){boundUpdate();let v=(yScale(0)-(pencilBound.y-margin.top+window.scrollY))/(xScale(t)-(pencilBound.x-margin.right+window.scrollX));if(s.includes("x"))return s.includes("bottom")?(v=(pencilBound.y+pencilBound.height-margin.top-9+window.scrollY-yScale(0))/(xScale(t)-(pencilBound.x-margin.right+window.scrollX)),yScale(0)-v*(xScale(0)-xScale(-focus))):yScale(0)+v*(xScale(0)-xScale(-focus));return s.includes("y")?s.includes("bottom")?(v=(pencilBound.y+pencilBound.height-9-margin.top+window.scrollY-yScale(0))/(xScale(focus)-xScale(0)),v*(xScale(100)-xScale(t))-u):(v=(yScale(0)-(pencilBound.y-margin.top+window.scrollY))/(xScale(focus)-xScale(0)),u+v*(xScale(100)-xScale(t))):void 0},i=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(100),y:2*(pencilBound.y-margin.top+window.scrollY)-g("y",0,pencilBound.y-margin.top+window.scrollY)}]},j=function(){return boundUpdate(),[{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(-focus),y:yScale(0)}]},k=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(0),y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(100),y:2*(pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)+g("y bottom",0,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},l=function(){return boundUpdate(),[{x:xScale(0),y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(-focus),y:yScale(0)}]},m=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(0),y:2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)},{x:xScale(100),y:2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},n=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(0),y:2*yScale(0)-g("x bottom",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)},{x:xScale(100),y:2*yScale(0)-g("x bottom",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},o=function(){return boundUpdate(),[{x:xScale(0),y:2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)},{x:xScale(-100),y:2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},p=function(){return boundUpdate(),[{x:xScale(0),y:2*yScale(0)-g("x bottom",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)},{x:xScale(-100),y:2*yScale(0)-g("x bottom",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY)}]},q=function(){boundUpdate();let s=xScale(0)-xScale(focus),t=xScale(0)-(pencilBound.x-margin.right+window.scrollX),v=g("x")-g("x bottom"),w=v/pencilBound.height;d3.select("#object-image").attr("transform","scale("+w+") translate("+(xScale(0)+1/(1/s-1/t))/w+", "+(2*yScale(0)-g("x",focus,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY))/w+")"),d3.select(".cls-1").style("fill","rgba(13, 159, 241, 0.5)")};q(),a();var r=d3.drag().on("start",function(){d3.select(this).raise()}).on("drag",function(){let s=this.getBoundingClientRect();var t=d3.event.x-s.width/2,u=d3.event.y-s.height/2;d3.select(this).attr("transform","translate("+Math.min(t,xScale(0)-s.width)+","+u+")"),a()});d3.select("#object").call(r)}function concaveMirrorRay(){function a(){boundUpdate();pencilBound.x-margin.right+window.scrollX>=xScale(-focus)-1&&pencilBound.x-margin.right+window.scrollX<=xScale(-focus)+1||(d3.selectAll(".solidRayTop").attr("d",line(i())),d3.select(".rayFocus").attr("d",line(k())),d3.select(".solidRayBottom").attr("d",line(j())),d3.select(".rayFocusBottom").attr("d",line(l())),d3.select(".dashedLineTop").attr("d",line(m())),d3.select(".dashedLineBottom").attr("d",line(n())),d3.select(".dashedExtraTop").attr("d",line(o())),d3.select(".dashedExtraBottom").attr("d",line(p())),d3.select(".dashedLineTop").attr("visibility","hidden"),d3.select(".dashedLineBottom").attr("visibility","hidden"),d3.select(".dashedExtraTop").attr("visibility","hidden"),d3.select(".dashedExtraBottom").attr("visibility","hidden"),q(),pencilBound.x-margin.right+window.scrollX>xScale(-focus)?(d3.select(".rayFocus").attr("stroke-dasharray","5 10"),d3.select(".rayFocusBottom").attr("stroke-dasharray","5 10"),d3.select(".dashedLineTop").attr("visibility","visible"),d3.select(".dashedLineBottom").attr("visibility","visible"),d3.select(".dashedExtraTop").attr("visibility","visible"),d3.select(".dashedExtraBottom").attr("visibility","visible")):(d3.select(".rayFocus").attr("stroke-dasharray","none"),d3.select(".rayFocusBottom").attr("stroke-dasharray","none")))}var e=d3.select("#concave-mirror2").node().getBoundingClientRect();svg.select("#concave-mirror2").attr("transform","translate("+(xScale(0)-e.width/2)+", "+0+")");let g=function(s,t=focus,u=yScale(0)){boundUpdate();let v=(yScale(0)-(pencilBound.y-margin.top+window.scrollY))/(xScale(-focus)-(pencilBound.x-margin.right+window.scrollX));if(s.includes("x"))return s.includes("bottom")?(v=(pencilBound.y+pencilBound.height-margin.top-9+window.scrollY-yScale(0))/(xScale(-focus)-(pencilBound.x-margin.right+window.scrollX)),yScale(0)-v*(xScale(0)-xScale(-focus))):yScale(0)+v*(xScale(0)-xScale(-focus));return s.includes("y")?s.includes("bottom")?(v=(pencilBound.y+pencilBound.height-9-margin.top+window.scrollY-yScale(0))/(xScale(focus)-xScale(0)),v*(xScale(100)-xScale(t))-u):(v=(yScale(0)-(pencilBound.y-margin.top+window.scrollY))/(xScale(focus)-xScale(0)),u+v*(xScale(100)-xScale(t))):void 0},i=function(){return boundUpdate(),pencilBound.x-margin.right+window.scrollX<xScale(-focus)?[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(-focus),y:yScale(0)},{x:xScale(-100),y:g("y")}]:[{x:xScale(-100),y:g("x")},{x:xScale(0),y:g("x")},{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(-focus),y:yScale(0)},{x:xScale(-100),y:g("y")}]},j=function(){return boundUpdate(),pencilBound.x-margin.right+window.scrollX<xScale(-focus)?[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(0),y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(-focus),y:yScale(0)},{x:xScale(-100),y:-g("y bottom")}]:[{x:xScale(-100),y:g("x bottom")},{x:xScale(0),y:g("x bottom")},{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(0),y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(-focus),y:yScale(0)},{x:xScale(-100),y:-g("y bottom")}]},k=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y-margin.top+window.scrollY},{x:xScale(-focus),y:yScale(0)},{x:xScale(0),y:g("x")},{x:xScale(-100),y:g("x")}]},l=function(){return boundUpdate(),[{x:pencilBound.x-margin.right+window.scrollX,y:pencilBound.y+pencilBound.height-margin.top-9+window.scrollY},{x:xScale(-focus),y:yScale(0)},{x:xScale(0),y:g("x bottom")},{x:xScale(-100),y:g("x bottom")}]},m=function(){return boundUpdate(),[{x:xScale(0),y:g("x")},{x:xScale(100),y:g("x")}]},n=function(){return boundUpdate(),[{x:xScale(0),y:g("x bottom")},{x:xScale(100),y:g("x bottom")}]},o=function(){return boundUpdate(),[{x:xScale(0),y:pencilBound.y-margin.top+window.scrollY},{x:xScale(100),y:2*(pencilBound.y-margin.top+window.scrollY)-g("y",0,pencilBound.y-margin.top+window.scrollY)}]},p=function(){return boundUpdate(),[{x:xScale(0),y:pencilBound.y+pencilBound.height-9-margin.top+window.scrollY},{x:xScale(100),y:g("y bottom",0,pencilBound.y+pencilBound.height-9-margin.top+window.scrollY-2*(pencilBound.y+pencilBound.height-9-margin.top+window.scrollY))}]};boundUpdate();let q=function(){boundUpdate();let s=xScale(focus)-xScale(0),t=xScale(0)-(pencilBound.x-margin.right+window.scrollX),u=1/(1/s-1/t),v=g("x")-g("x bottom"),w=v/pencilBound.height;pencilBound.x-margin.right+window.scrollX>xScale(-focus)?(d3.select("#object-image").attr("transform","rotate(180) scale("+w+") translate("+-(xScale(0)-u)/w+", "+-g("x")/w+")"),d3.select(".cls-1").style("fill","rgba(13, 159, 241, 0.5)")):(d3.select("#object-image").attr("transform","rotate(180) scale("+w+") translate("+-(xScale(0)-u)/w+", "+-g("x")/w+")"),d3.select(".cls-1").style("fill","rgba(255, 255, 0, 0.5)"))};q(),a();var r=d3.drag().on("start",function(){d3.select(this).raise()}).on("drag",function(){let s=this.getBoundingClientRect();var t=d3.event.x-s.width/2,u=d3.event.y-s.height/2;d3.select(this).attr("transform","translate("+Math.min(t,xScale(0)-s.width)+","+u+")"),a()});d3.select("#object").call(r)}d3.select("#convex-lens").on("click",function(){d3.select(".rayFocus").style("opacity",1),d3.select(".rayFocusBottom").style("opacity",1),d3.select(".dashedExtraTop").style("opacity",1),d3.select(".dashedExtraBottom").style("opacity",1),d3.select(".dashedLineTop").style("opacity",1),d3.select(".dashedLineBottom").style("opacity",1),d3.select("#eye").attr("visibility","hidden"),d3.select(".dashedRayTop").style("opacity",0),d3.select(".dashedRayBottom").style("opacity",0),d3.selectAll(".focusData").attr("visibility","visible"),convexLensRay()}),d3.select("#plane-mirror").on("click",function(){d3.select(".rayFocus").style("opacity",0),d3.select(".rayFocusBottom").style("opacity",0),d3.select(".dashedExtraTop").style("opacity",0),d3.select(".dashedExtraBottom").style("opacity",0),d3.select(".dashedLineTop").style("opacity",0),d3.select(".dashedLineBottom").style("opacity",0),d3.select("#eye").attr("visibility","visible"),d3.select(".dashedRayTop").style("opacity",1),d3.select(".dashedRayBottom").style("opacity",1),d3.select(".cls-1").style("fill","rgba(13, 159, 241, 0.5)"),d3.selectAll(".focusData").attr("visibility","hidden"),planeMirrorRay()}),d3.select("#convex-mirror").on("click",function(){d3.select(".rayFocus").style("opacity",1),d3.select(".rayFocusBottom").style("opacity",1),d3.select(".dashedExtraTop").style("opacity",1),d3.select(".dashedExtraBottom").style("opacity",1),d3.select(".dashedLineTop").style("opacity",1),d3.select(".dashedLineBottom").style("opacity",1),d3.select("#eye").attr("visibility","hidden"),d3.select(".dashedRayTop").style("opacity",0),d3.select(".dashedRayBottom").style("opacity",0),d3.selectAll(".focusData").attr("visibility","visible"),convexMirrorRay()}),d3.select("#concave-lens").on("click",function(){d3.select(".rayFocus").style("opacity",1),d3.select(".rayFocusBottom").style("opacity",1),d3.select(".dashedExtraTop").style("opacity",1),d3.select(".dashedExtraBottom").style("opacity",1),d3.select(".dashedLineTop").style("opacity",1),d3.select(".dashedLineBottom").style("opacity",1),d3.select("#eye").attr("visibility","hidden"),d3.select(".dashedRayTop").style("opacity",0),d3.select(".dashedRayBottom").style("opacity",0),d3.selectAll(".focusData").attr("visibility","visible"),concaveLensRay()}),d3.select("#concave-mirror").on("click",function(){d3.select(".rayFocus").style("opacity",1),d3.select(".rayFocusBottom").style("opacity",1),d3.select(".dashedExtraTop").style("opacity",1),d3.select(".dashedExtraBottom").style("opacity",1),d3.select(".dashedLineTop").style("opacity",1),d3.select(".dashedLineBottom").style("opacity",1),d3.select("#eye").attr("visibility","hidden"),d3.select(".dashedRayTop").style("opacity",0),d3.select(".dashedRayBottom").style("opacity",0),d3.selectAll(".focusData").attr("visibility","visible"),concaveMirrorRay()});function boundUpdate(){return pencilBound=d3.select("#object").node().getBoundingClientRect(),imageBound=d3.select("#object-image").node().getBoundingClientRect(),"Plane Mirror"===app.name?(eyeBound=d3.select("#eye").node().getBoundingClientRect(),[pencilBound,eyeBound,imageBound]):[pencilBound,imageBound]}